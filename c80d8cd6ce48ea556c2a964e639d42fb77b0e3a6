Revision: c80d8cd6ce48ea556c2a964e639d42fb77b0e3a6
Patch-set: 6
File: media/mtp/MtpStringBuffer.cpp

63
Fri Dec 20 15:26:11 2013 +0000
Author: Marco Nelissen <1001525@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a8649bc8_f4f018be
Bytes: 426
"length" is the number of bytes here, not the number of characters. A character can consist of multiple bytes (which is why mBuffer is allocated at size (255*3+1)), so you might end up copying substantially less characters than needed.
You should instead work this into the loop below, similar to what's done for set(uint16_t*) below, and calculate the actual number of characters and bytes as you're parsing the input string.

